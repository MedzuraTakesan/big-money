# Функционал парсинга отзывов

## Описание

Добавлен новый функционал для парсинга отзывов с маркетплейсов Wildberries и Ozon. Пользователи могут получить до 32 отзывов о товаре, нажав кнопку "Получить отзывы" под карточкой товара.

## Архитектура

### Backend

#### Новые файлы:
- `server/services/ReviewsService.js` - сервис для парсинга отзывов
- `server/controllers/ReviewsController.js` - контроллер для обработки запросов
- `server/components/ReviewsModal/index.vue` - модальное окно для отображения отзывов

#### Измененные файлы:
- `server/constants/server.js` - добавлен новый эндпоинт `/get-reviews`
- `server/routes/ProductRoutes.js` - добавлен маршрут для получения отзывов

### Frontend

#### Новые файлы:
- `front/app/components/ReviewsModal/index.vue` - модальное окно отзывов
- `front/app/stores/reviews/index.ts` - Pinia store для управления отзывами

#### Измененные файлы:
- `front/app/components/products/ProductCard/index.vue` - добавлена кнопка "Получить отзывы"
- `front/app/components/products/ProductCard/styles.scss` - стили для кнопки отзывов
- `front/app/components/products/index.vue` - интеграция модального окна

## API

### GET /get-reviews

Получает отзывы о товаре по URL.

**Параметры:**
- `url` (string, обязательный) - URL товара с Wildberries или Ozon

**Пример запроса:**
```
GET /get-reviews?url=https://www.wildberries.ru/catalog/123456/detail.aspx
```

**Ответ:**
```json
{
  "success": true,
  "data": [
    {
      "author": "Ирина",
      "text": "Отличный товар! Очень довольна покупкой.",
      "rating": 5
    }
  ]
}
```

## Поддерживаемые маркетплейсы

### Wildberries
- URL товара: `https://www.wildberries.ru/catalog/{id}/detail.aspx`
- URL отзывов: `https://www.wildberries.ru/catalog/{id}/feedbacks`
- Парсинг: отдельная страница отзывов

### Ozon
- URL товара: `https://www.ozon.ru/product/{id}/`
- Парсинг: отзывы на странице товара (скролл вниз)

## Особенности реализации

### Парсинг Wildberries
1. Извлекаем ID товара из URL
2. Формируем URL страницы отзывов
3. Используем те же настройки, что и в парсинге товаров
4. Ждем загрузки основного контента
5. Пробуем разные селекторы для поиска отзывов
6. Извлекаем имя автора, текст и рейтинг с множественными попытками

### Парсинг Ozon
1. Открываем страницу товара с теми же настройками, что и в парсинге товаров
2. Используем простой скролл вниз (как в парсинге товаров)
3. Ждем загрузки контента
4. Пробуем разные селекторы для поиска отзывов
5. Извлекаем имя автора, текст и рейтинг с множественными попытками

### Ограничения
- Максимум 32 отзыва на запрос
- Только текст и оценка (без личных данных)
- Поддержка только Wildberries и Ozon

## Использование

1. Найдите товар в результатах поиска
2. Нажмите кнопку "Получить отзывы" под карточкой товара
3. Дождитесь загрузки отзывов в модальном окне
4. Просмотрите отзывы с рейтингами

## Технические детали

### Puppeteer и Browser Manager
Используется существующий `browser-manager` для парсинга динамического контента:
- Пул браузеров для лучшей производительности
- Stealth режим для обхода блокировок
- Автоматическое управление жизненным циклом браузеров
- Оптимизированные настройки для каждого маркетплейса

### Обработка ошибок
- Валидация URL
- Таймауты для загрузки страниц
- Graceful fallback при ошибках парсинга
- Множественные попытки с разными селекторами
- Подробное логирование для отладки
- Защита от блокировки ботов (случайные задержки, реалистичные заголовки)

### Производительность
- Пул браузеров для параллельной обработки
- Кэширование браузеров через browser-manager
- Ограничение количества отзывов
- Асинхронная обработка

## Архитектура

### Store Pattern
Используется Pinia store для управления состоянием отзывов:
- Централизованное управление состоянием
- Разделение бизнес-логики и UI
- Реактивность данных
- Геттеры для вычисляемых значений

### Компоненты
- `ProductCard` - отображает кнопку получения отзывов
- `ReviewsModal` - модальное окно с отзывами
- `Products` - контейнер для списка товаров

## Зависимости

### Backend
- `puppeteer` - для парсинга динамического контента
- `express` - для API эндпоинтов

### Frontend
- `vue` - для компонентов
- `nuxt` - для SSR и роутинга
- `pinia` - для управления состоянием
